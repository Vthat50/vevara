import {
  Topic,
  ConversationAnalytics,
  Playbook,
  Spotlight,
  TopicTrend,
  ConversationMetrics,
  RootCauseAnalysis,
  ConversationSnippet,
  FrictionPoint,
  AnalyzedMessage,
} from '@/types/conversationIntelligence';
import { pharmaTopics } from './pharmaTopics';

// Re-export pharma topics for convenience
export { pharmaTopics };

// Pharma playbook templates
export const pharmaPlaybooks: Playbook[] = [
  {
    id: 'hub-services',
    name: 'Hub Services',
    description: 'Track all hub services interactions including enrollment, copay, reimbursement, and access support',
    category: 'hub-services',
    topics: ['topic-copay', 'topic-prior-auth', 'topic-enrollment', 'topic-refill', 'topic-escalation', 'topic-satisfaction'],
    isTemplate: true,
    createdBy: 'System',
    createdAt: '2025-01-15',
    lastModified: '2025-01-15',
    active: true,
    metrics: {
      conversationsAnalyzed: 487,
      topicsDetected: 1842,
      avgSentiment: 0.67,
      frictionPointsFound: 124,
    },
  },
  {
    id: 'adherence',
    name: 'Adherence Support',
    description: 'Monitor adherence conversations, refill reminders, and therapy continuation',
    category: 'adherence',
    topics: ['topic-adherence', 'topic-refill', 'topic-side-effects', 'topic-abandonment', 'topic-administration'],
    isTemplate: true,
    createdBy: 'System',
    createdAt: '2025-01-15',
    lastModified: '2025-01-15',
    active: true,
    metrics: {
      conversationsAnalyzed: 612,
      topicsDetected: 1456,
      avgSentiment: 0.72,
      frictionPointsFound: 87,
    },
  },
  {
    id: 'clinical',
    name: 'Clinical Concerns',
    description: 'Track side effects, adverse events, administration questions, and clinical support needs',
    category: 'clinical',
    topics: ['topic-side-effects', 'topic-administration', 'topic-escalation'],
    isTemplate: true,
    createdBy: 'System',
    createdAt: '2025-01-15',
    lastModified: '2025-01-15',
    active: true,
    metrics: {
      conversationsAnalyzed: 234,
      topicsDetected: 687,
      avgSentiment: 0.45,
      frictionPointsFound: 156,
    },
  },
  {
    id: 'access',
    name: 'Patient Access',
    description: 'Monitor barriers to access including affordability, insurance, and prior authorization issues',
    category: 'access',
    topics: ['topic-copay', 'topic-prior-auth', 'topic-enrollment', 'topic-abandonment'],
    isTemplate: true,
    createdBy: 'System',
    createdAt: '2025-01-15',
    lastModified: '2025-01-15',
    active: true,
    metrics: {
      conversationsAnalyzed: 345,
      topicsDetected: 1123,
      avgSentiment: 0.52,
      frictionPointsFound: 198,
    },
  },
];

// Lazy load unified conversations to avoid circular dependency
function getUnifiedConversations() {
  const { allUnifiedConversations } = require('./unifiedConversations');
  return allUnifiedConversations;
}

// Use unified conversations (from existing adherence, inbound, outbound data)
export const analyzedConversations: ConversationAnalytics[] = getUnifiedConversations();

// LEGACY MOCK DATA (kept for reference, not used)
const legacyMockConversations: ConversationAnalytics[] = [
  {
    id: 'analytics-001',
    conversationId: 'call-001',
    patientId: 'OB001',
    patientName: 'Michael Anderson',
    conversationType: 'outbound-enrollment',
    callDate: '2025-01-28',
    callTime: '14:30',
    duration: 323,
    transcript: [
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'Hello, this is the AVONEX support program calling for Michael Anderson. Am I speaking with Michael?',
        timestamp: '14:30:00',
        sentiment: 'neutral',
        sentimentScore: 0.0,
        detectedTopics: ['topic-enrollment'],
        keyMoment: true,
      },
      {
        speaker: 'patient',
        speakerLabel: 'Michael Anderson',
        message: 'Yes, this is Michael.',
        timestamp: '14:30:05',
        sentiment: 'neutral',
        sentimentScore: 0.0,
        detectedTopics: [],
      },
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'Great! I\'m calling to help you enroll in the AVONEX Copay Assistance Program. Your doctor, Dr. Michael Cheng, has already consented to your enrollment. This program can help reduce your out-of-pocket costs. Do you have a few minutes to discuss this?',
        timestamp: '14:30:12',
        sentiment: 'positive',
        sentimentScore: 0.6,
        detectedTopics: ['topic-enrollment', 'topic-copay'],
      },
      {
        speaker: 'patient',
        speakerLabel: 'Michael Anderson',
        message: 'Yes, that would be great. I\'ve been worried about the cost.',
        timestamp: '14:30:25',
        sentiment: 'neutral',
        sentimentScore: 0.1,
        detectedTopics: ['topic-copay'],
        frictionDetected: true,
      },
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'I completely understand. Let me help you with that. First, I need to verify some information. Can you confirm your date of birth is March 15, 1978?',
        timestamp: '14:30:32',
        sentiment: 'positive',
        sentimentScore: 0.4,
        detectedTopics: ['topic-enrollment'],
      },
      {
        speaker: 'patient',
        speakerLabel: 'Michael Anderson',
        message: 'Yes, that\'s correct.',
        timestamp: '14:30:38',
        sentiment: 'neutral',
        sentimentScore: 0.0,
        detectedTopics: [],
      },
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'Perfect. And your insurance carrier is Blue Cross Blue Shield, policy number BC789456123?',
        timestamp: '14:30:42',
        sentiment: 'neutral',
        sentimentScore: 0.0,
        detectedTopics: ['topic-copay'],
      },
      {
        speaker: 'patient',
        speakerLabel: 'Michael Anderson',
        message: 'Yes, that\'s right.',
        timestamp: '14:30:47',
        sentiment: 'neutral',
        sentimentScore: 0.0,
        detectedTopics: [],
      },
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'Excellent. Based on your insurance, you qualify for the copay assistance program. With this program, your copay will be reduced from approximately $150 to $0 per prescription. That\'s a savings of about $1,800 per year.',
        timestamp: '14:30:52',
        sentiment: 'positive',
        sentimentScore: 0.8,
        detectedTopics: ['topic-copay', 'topic-enrollment'],
        keyMoment: true,
      },
      {
        speaker: 'patient',
        speakerLabel: 'Michael Anderson',
        message: 'Wow, that\'s amazing! That will really help. What do I need to do?',
        timestamp: '14:31:05',
        sentiment: 'positive',
        sentimentScore: 0.9,
        detectedTopics: ['topic-copay'],
      },
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'I just need your verbal consent to enroll you in the program. Do you consent to enrollment in the AVONEX Copay Assistance Program?',
        timestamp: '14:31:15',
        sentiment: 'neutral',
        sentimentScore: 0.0,
        detectedTopics: ['topic-enrollment'],
        keyMoment: true,
      },
      {
        speaker: 'patient',
        speakerLabel: 'Michael Anderson',
        message: 'Yes, absolutely!',
        timestamp: '14:31:22',
        sentiment: 'positive',
        sentimentScore: 0.95,
        detectedTopics: ['topic-enrollment'],
      },
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'Perfect! You\'re all enrolled. I\'ll send you a confirmation email and text with your copay card information within the next hour. You can use this card at the pharmacy starting with your next refill. Is there anything else I can help you with today?',
        timestamp: '14:31:28',
        sentiment: 'positive',
        sentimentScore: 0.7,
        detectedTopics: ['topic-enrollment', 'topic-refill', 'topic-satisfaction'],
      },
      {
        speaker: 'patient',
        speakerLabel: 'Michael Anderson',
        message: 'No, that\'s great. Thank you so much for your help!',
        timestamp: '14:31:45',
        sentiment: 'positive',
        sentimentScore: 0.95,
        detectedTopics: ['topic-satisfaction'],
      },
    ],
    overallSentiment: 'positive',
    sentimentScore: 0.78,
    sentimentShift: 0.85,
    topicsDetected: ['topic-enrollment', 'topic-copay', 'topic-refill', 'topic-satisfaction'],
    primaryTopic: 'topic-enrollment',
    resolutionStatus: 'resolved',
    resolutionTime: 323,
    escalated: false,
    csatScore: 5,
    npsScore: 10,
    qualityScore: 95,
    complianceScore: 98,
    empathyScore: 88,
    frictionPoints: [
      {
        id: 'friction-001',
        conversationId: 'call-001',
        messageIndex: 3,
        barrierType: 'affordability',
        description: 'Patient expressed worry about medication cost',
        severity: 'medium',
        resolved: true,
        resolutionAction: 'Enrolled in copay assistance program',
        snippet: 'I\'ve been worried about the cost.',
      },
    ],
    frictionScore: 15,
    callDriver: 'Copay Program Enrollment',
    outcomeAchieved: true,
    riskLevel: 'low',
    abandonmentSignals: [],
    churnRisk: 5,
    tags: ['successful-enrollment', 'high-satisfaction'],
    notes: 'Excellent conversation with positive outcome',
    reviewed: true,
    reviewedBy: 'System',
    reviewedAt: '2025-01-28T14:35:00Z',
  },
  {
    id: 'analytics-002',
    conversationId: 'call-002',
    patientId: 'AD003',
    patientName: 'Robert Johnson',
    conversationType: 'adherence-checkin',
    callDate: '2025-01-27',
    callTime: '10:15',
    duration: 412,
    transcript: [
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'Hello Robert, this is your Humira support program. I\'m calling to check in on how you\'re doing with your medication. Do you have a moment to talk?',
        timestamp: '10:15:00',
        sentiment: 'neutral',
        sentimentScore: 0.2,
        detectedTopics: ['topic-adherence'],
        keyMoment: true,
      },
      {
        speaker: 'patient',
        speakerLabel: 'Robert Johnson',
        message: 'I guess so. To be honest, I\'ve been having some issues.',
        timestamp: '10:15:08',
        sentiment: 'negative',
        sentimentScore: -0.4,
        detectedTopics: [],
        frictionDetected: true,
      },
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'I\'m sorry to hear that. I\'m here to help. Can you tell me what\'s been going on?',
        timestamp: '10:15:15',
        sentiment: 'positive',
        sentimentScore: 0.5,
        detectedTopics: ['topic-escalation'],
      },
      {
        speaker: 'patient',
        speakerLabel: 'Robert Johnson',
        message: 'Well, the injections hurt more than I expected, and I\'ve been getting headaches afterward. Also, I missed my dose last week because I ran out.',
        timestamp: '10:15:22',
        sentiment: 'negative',
        sentimentScore: -0.6,
        detectedTopics: ['topic-side-effects', 'topic-adherence', 'topic-refill'],
        frictionDetected: true,
        keyMoment: true,
      },
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'I understand, and thank you for sharing that with me. Let\'s address each of these. First, regarding the injection pain and headaches - these are side effects we should discuss with your healthcare provider. I\'d like to schedule a nurse callback for you. Is that okay?',
        timestamp: '10:15:45',
        sentiment: 'neutral',
        sentimentScore: 0.2,
        detectedTopics: ['topic-side-effects', 'topic-escalation'],
      },
      {
        speaker: 'patient',
        speakerLabel: 'Robert Johnson',
        message: 'Yes, I think I need to talk to someone about it. It\'s making me wonder if this medication is even worth it.',
        timestamp: '10:15:58',
        sentiment: 'negative',
        sentimentScore: -0.7,
        detectedTopics: ['topic-abandonment', 'topic-side-effects'],
        frictionDetected: true,
        keyMoment: true,
      },
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'I hear your frustration, Robert. Many patients experience side effects initially that often improve over time. Our nurse can discuss techniques to reduce injection pain and evaluate your headaches. Regarding your missed dose - let\'s make sure you have your next shipment scheduled. When is your next injection due?',
        timestamp: '10:16:15',
        sentiment: 'positive',
        sentimentScore: 0.4,
        detectedTopics: ['topic-side-effects', 'topic-adherence', 'topic-refill'],
      },
      {
        speaker: 'patient',
        speakerLabel: 'Robert Johnson',
        message: 'It\'s supposed to be this Friday, but I don\'t have the medication yet.',
        timestamp: '10:16:32',
        sentiment: 'negative',
        sentimentScore: -0.5,
        detectedTopics: ['topic-refill', 'topic-adherence'],
        frictionDetected: true,
      },
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'Let me check on your refill status right now. I see your prescription was submitted to the pharmacy last week. There may have been a delay. I\'m going to expedite this and have it shipped overnight so you receive it by Thursday. Will you be home to receive it?',
        timestamp: '10:16:42',
        sentiment: 'positive',
        sentimentScore: 0.6,
        detectedTopics: ['topic-refill'],
        keyMoment: true,
      },
      {
        speaker: 'patient',
        speakerLabel: 'Robert Johnson',
        message: 'Yes, I work from home. Thank you, that helps.',
        timestamp: '10:17:05',
        sentiment: 'neutral',
        sentimentScore: 0.2,
        detectedTopics: ['topic-satisfaction'],
      },
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'You\'re welcome. So to summarize: I\'m having a nurse call you within 24 hours to discuss the injection pain and headaches, and I\'ve expedited your refill for overnight delivery. You should receive a tracking number via text within the hour. Is there anything else I can help with?',
        timestamp: '10:17:12',
        sentiment: 'positive',
        sentimentScore: 0.5,
        detectedTopics: ['topic-escalation', 'topic-refill'],
      },
      {
        speaker: 'patient',
        speakerLabel: 'Robert Johnson',
        message: 'No, I think that covers it. I appreciate you helping me sort this out.',
        timestamp: '10:17:35',
        sentiment: 'positive',
        sentimentScore: 0.6,
        detectedTopics: ['topic-satisfaction'],
      },
    ],
    overallSentiment: 'neutral',
    sentimentScore: -0.12,
    sentimentShift: 1.0,
    topicsDetected: ['topic-adherence', 'topic-side-effects', 'topic-refill', 'topic-abandonment', 'topic-escalation', 'topic-satisfaction'],
    primaryTopic: 'topic-side-effects',
    resolutionStatus: 'escalated',
    resolutionTime: 412,
    escalated: true,
    escalationReason: 'Side effects require nurse evaluation',
    csatScore: 4,
    qualityScore: 87,
    complianceScore: 95,
    empathyScore: 92,
    frictionPoints: [
      {
        id: 'friction-002',
        conversationId: 'call-002',
        messageIndex: 1,
        barrierType: 'clinical',
        description: 'Patient indicated general dissatisfaction',
        severity: 'medium',
        resolved: true,
        resolutionAction: 'Addressed concerns, scheduled nurse callback',
        snippet: 'To be honest, I\'ve been having some issues.',
      },
      {
        id: 'friction-003',
        conversationId: 'call-002',
        messageIndex: 3,
        barrierType: 'clinical',
        description: 'Multiple side effects reported (injection pain, headaches)',
        severity: 'high',
        resolved: true,
        resolutionAction: 'Scheduled nurse callback for evaluation',
        snippet: 'The injections hurt more than I expected, and I\'ve been getting headaches afterward.',
      },
      {
        id: 'friction-004',
        conversationId: 'call-002',
        messageIndex: 3,
        barrierType: 'access',
        description: 'Missed dose due to running out of medication',
        severity: 'high',
        resolved: true,
        resolutionAction: 'Expedited refill with overnight shipping',
        snippet: 'I missed my dose last week because I ran out.',
      },
      {
        id: 'friction-005',
        conversationId: 'call-002',
        messageIndex: 5,
        barrierType: 'clinical',
        description: 'Therapy abandonment signal detected',
        severity: 'high',
        resolved: true,
        resolutionAction: 'Provided reassurance, escalated to nurse',
        snippet: 'It\'s making me wonder if this medication is even worth it.',
      },
    ],
    frictionScore: 78,
    callDriver: 'Adherence Check-in',
    outcomeAchieved: true,
    riskLevel: 'high',
    abandonmentSignals: ['questioning medication value', 'side effects causing distress', 'missed dose'],
    churnRisk: 72,
    tags: ['high-risk', 'nurse-callback-needed', 'refill-expedited'],
    notes: 'Patient at risk of abandonment due to side effects. Requires close monitoring.',
    reviewed: true,
    reviewedBy: 'System',
    reviewedAt: '2025-01-27T10:25:00Z',
  },
  {
    id: 'analytics-003',
    conversationId: 'inbound-001',
    patientId: 'IB001',
    patientName: 'Alice Johnson',
    conversationType: 'inbound',
    callDate: '2025-01-30',
    callTime: '09:15',
    duration: 185,
    transcript: [
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'Thank you for calling. This is the medication support line. How can I help you today?',
        timestamp: '09:15:00',
        sentiment: 'neutral',
        sentimentScore: 0.3,
        detectedTopics: [],
        keyMoment: true,
      },
      {
        speaker: 'patient',
        speakerLabel: 'Alice Johnson',
        message: 'Hi, I need to refill my prescription. I\'m running low.',
        timestamp: '09:15:06',
        sentiment: 'neutral',
        sentimentScore: 0.0,
        detectedTopics: ['topic-refill'],
      },
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'I\'d be happy to help you with that refill. Can you please provide your name and date of birth?',
        timestamp: '09:15:12',
        sentiment: 'positive',
        sentimentScore: 0.5,
        detectedTopics: ['topic-refill'],
      },
      {
        speaker: 'patient',
        speakerLabel: 'Alice Johnson',
        message: 'Alice Johnson, March 22, 1985.',
        timestamp: '09:15:18',
        sentiment: 'neutral',
        sentimentScore: 0.0,
        detectedTopics: [],
      },
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'Thank you, Alice. I see you\'re on Enbrel. Your last refill was 3 weeks ago. Let me check your prescription status... Great news - you have refills available. When would you like to receive your next shipment?',
        timestamp: '09:15:24',
        sentiment: 'positive',
        sentimentScore: 0.6,
        detectedTopics: ['topic-refill'],
      },
      {
        speaker: 'patient',
        speakerLabel: 'Alice Johnson',
        message: 'As soon as possible, please. I only have about 4 days left.',
        timestamp: '09:15:38',
        sentiment: 'neutral',
        sentimentScore: 0.1,
        detectedTopics: ['topic-refill', 'topic-adherence'],
      },
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'I understand the urgency. I can have this shipped overnight to arrive tomorrow by 10:30 AM. Would that work for you?',
        timestamp: '09:15:46',
        sentiment: 'positive',
        sentimentScore: 0.7,
        detectedTopics: ['topic-refill'],
      },
      {
        speaker: 'patient',
        speakerLabel: 'Alice Johnson',
        message: 'Yes, that would be perfect. Thank you!',
        timestamp: '09:15:53',
        sentiment: 'positive',
        sentimentScore: 0.85,
        detectedTopics: ['topic-satisfaction'],
      },
      {
        speaker: 'ai',
        speakerLabel: 'AI Assistant',
        message: 'You\'re all set! I\'ve processed your refill for overnight delivery. You\'ll receive a text with tracking information shortly. Is there anything else I can help you with today?',
        timestamp: '09:15:58',
        sentiment: 'positive',
        sentimentScore: 0.7,
        detectedTopics: ['topic-refill', 'topic-satisfaction'],
      },
      {
        speaker: 'patient',
        speakerLabel: 'Alice Johnson',
        message: 'No, that\'s all. I really appreciate your help!',
        timestamp: '09:16:12',
        sentiment: 'positive',
        sentimentScore: 0.9,
        detectedTopics: ['topic-satisfaction'],
      },
    ],
    overallSentiment: 'positive',
    sentimentScore: 0.72,
    sentimentShift: 0.6,
    topicsDetected: ['topic-refill', 'topic-adherence', 'topic-satisfaction'],
    primaryTopic: 'topic-refill',
    resolutionStatus: 'resolved',
    resolutionTime: 185,
    escalated: false,
    csatScore: 5,
    npsScore: 9,
    qualityScore: 93,
    complianceScore: 97,
    empathyScore: 85,
    frictionPoints: [],
    frictionScore: 8,
    callDriver: 'Refill Request',
    outcomeAchieved: true,
    riskLevel: 'low',
    abandonmentSignals: [],
    churnRisk: 12,
    tags: ['quick-resolution', 'high-satisfaction'],
    notes: 'Smooth, efficient refill request handled well',
    reviewed: true,
    reviewedBy: 'System',
    reviewedAt: '2025-01-30T09:20:00Z',
  },
];

// Spotlights - auto-generated insights
export const spotlights: Spotlight[] = [
  {
    id: 'spotlight-001',
    type: 'risk-alert',
    title: 'Therapy Abandonment Risk Increasing',
    description: '45% increase in patients expressing "too expensive" concerns this week compared to last week',
    metric: '45% increase',
    severity: 'critical',
    dateDetected: '2025-01-29',
    timeFrame: 'this week',
    affectedConversations: 12,
    topicId: 'topic-copay',
    actionRecommended: 'Proactively reach out to offer copay assistance program enrollment',
    dismissed: false,
  },
  {
    id: 'spotlight-002',
    type: 'emerging-issue',
    title: 'Prior Authorization Frustration Trending Up',
    description: 'PA-related negative sentiment increased 67%, causing enrollment delays and patient frustration',
    metric: '67% increase',
    severity: 'warning',
    dateDetected: '2025-01-28',
    timeFrame: 'last 2 weeks',
    affectedConversations: 23,
    topicId: 'topic-prior-auth',
    actionRecommended: 'Review PA support process and reduce patient-facing delays',
    dismissed: false,
  },
  {
    id: 'spotlight-003',
    type: 'positive-trend',
    title: 'Injection Training Improves Adherence',
    description: 'Patients who received injection training demonstrate 28% better adherence rates',
    metric: '28% improvement',
    severity: 'positive',
    dateDetected: '2025-01-27',
    timeFrame: 'last 30 days',
    affectedConversations: 45,
    topicId: 'topic-administration',
    actionRecommended: 'Expand injection training program to all new patients',
    dismissed: false,
  },
  {
    id: 'spotlight-004',
    type: 'operational-win',
    title: 'First Call Resolution Rate Improving',
    description: 'FCR increased from 68% to 82% after implementing new refill automation',
    metric: '14% improvement',
    severity: 'positive',
    dateDetected: '2025-01-26',
    timeFrame: 'this month',
    affectedConversations: 187,
    topicId: 'topic-refill',
    actionRecommended: 'Document best practices and apply to other call types',
    dismissed: false,
  },
  {
    id: 'spotlight-005',
    type: 'risk-alert',
    title: 'Repeat Callers with Unresolved Insurance Questions',
    description: '45% of repeat callers (3+ calls) have unresolved insurance or coverage questions',
    metric: '45% of repeat callers',
    severity: 'warning',
    dateDetected: '2025-01-25',
    timeFrame: 'this month',
    affectedConversations: 34,
    topicId: 'topic-copay',
    actionRecommended: 'Enhance insurance support materials and agent training',
    dismissed: false,
  },
  {
    id: 'spotlight-006',
    type: 'emerging-issue',
    title: 'Side Effect Concerns During Winter Months',
    description: 'Side effect mentions increased 34% in January, particularly injection site reactions',
    metric: '34% increase',
    severity: 'warning',
    dateDetected: '2025-01-24',
    timeFrame: 'this month vs last month',
    affectedConversations: 56,
    topicId: 'topic-side-effects',
    actionRecommended: 'Create proactive winter injection tips communication',
    dismissed: false,
  },
];

// Topic trends
export const topicTrends: TopicTrend[] = [
  {
    topicId: 'topic-copay',
    topicName: 'Copay & Insurance',
    mentions: 234,
    previousMentions: 198,
    trendDirection: 'up',
    trendPercentage: 18,
    avgSentiment: 'positive',
    sentimentScore: 0.67,
    sentimentTrend: 'up',
    conversationCount: 167,
    sparklineData: [32, 28, 35, 31, 38, 36, 34],
    color: '#3B82F6',
  },
  {
    topicId: 'topic-refill',
    topicName: 'Refill & Coordination',
    mentions: 312,
    previousMentions: 298,
    trendDirection: 'stable',
    trendPercentage: 5,
    avgSentiment: 'positive',
    sentimentScore: 0.78,
    sentimentTrend: 'up',
    conversationCount: 245,
    sparklineData: [42, 44, 45, 43, 46, 45, 47],
    color: '#10B981',
  },
  {
    topicId: 'topic-side-effects',
    topicName: 'Side Effects',
    mentions: 89,
    previousMentions: 67,
    trendDirection: 'up',
    trendPercentage: 33,
    avgSentiment: 'negative',
    sentimentScore: -0.42,
    sentimentTrend: 'down',
    conversationCount: 76,
    sparklineData: [8, 10, 11, 14, 15, 16, 15],
    color: '#EF4444',
  },
  {
    topicId: 'topic-prior-auth',
    topicName: 'Prior Authorization',
    mentions: 67,
    previousMentions: 45,
    trendDirection: 'up',
    trendPercentage: 49,
    avgSentiment: 'negative',
    sentimentScore: -0.58,
    sentimentTrend: 'down',
    conversationCount: 58,
    sparklineData: [5, 6, 7, 9, 11, 13, 16],
    color: '#F59E0B',
  },
  {
    topicId: 'topic-administration',
    topicName: 'Administration & Usage',
    mentions: 124,
    previousMentions: 135,
    trendDirection: 'down',
    trendPercentage: -8,
    avgSentiment: 'neutral',
    sentimentScore: 0.15,
    sentimentTrend: 'stable',
    conversationCount: 98,
    sparklineData: [20, 19, 18, 18, 17, 16, 16],
    color: '#8B5CF6',
  },
  {
    topicId: 'topic-adherence',
    topicName: 'Adherence Support',
    mentions: 198,
    previousMentions: 187,
    trendDirection: 'stable',
    trendPercentage: 6,
    avgSentiment: 'positive',
    sentimentScore: 0.55,
    sentimentTrend: 'stable',
    conversationCount: 156,
    sparklineData: [28, 27, 29, 28, 30, 28, 28],
    color: '#14B8A6',
  },
  {
    topicId: 'topic-satisfaction',
    topicName: 'Satisfaction & Feedback',
    mentions: 421,
    previousMentions: 389,
    trendDirection: 'up',
    trendPercentage: 8,
    avgSentiment: 'positive',
    sentimentScore: 0.91,
    sentimentTrend: 'up',
    conversationCount: 334,
    sparklineData: [58, 56, 59, 62, 63, 61, 62],
    color: '#22C55E',
  },
];

// Calculate real metrics from unified conversations
const calculateMetrics = (): ConversationMetrics => {
  const conversations = getUnifiedConversations();
  const totalConv = conversations.length;

  // Count by type
  const byType: Record<string, number> = {};
  conversations.forEach((c: ConversationAnalytics) => {
    byType[c.conversationType] = (byType[c.conversationType] || 0) + 1;
  });

  // Calculate averages
  const avgSentiment = conversations.reduce((sum: number, c: ConversationAnalytics) => sum + c.sentimentScore, 0) / totalConv;
  const avgQuality = conversations.reduce((sum: number, c: ConversationAnalytics) => sum + c.qualityScore, 0) / totalConv;
  const avgCompliance = conversations.reduce((sum: number, c: ConversationAnalytics) => sum + c.complianceScore, 0) / totalConv;
  const avgHandleTime = Math.round(conversations.reduce((sum: number, c: ConversationAnalytics) => sum + c.duration, 0) / totalConv);

  // Calculate CSAT and NPS averages (only from conversations that have scores)
  const csatConversations = conversations.filter((c: ConversationAnalytics) => c.csatScore !== undefined);
  const npsConversations = conversations.filter((c: ConversationAnalytics) => c.npsScore !== undefined);
  const avgCsat = csatConversations.length > 0
    ? csatConversations.reduce((sum: number, c: ConversationAnalytics) => sum + (c.csatScore || 0), 0) / csatConversations.length
    : 0;
  const avgNps = npsConversations.length > 0
    ? npsConversations.reduce((sum: number, c: ConversationAnalytics) => sum + (c.npsScore || 0), 0) / npsConversations.length
    : 0;

  // Sentiment distribution
  const positive = conversations.filter(c => c.overallSentiment === 'positive').length;
  const neutral = conversations.filter(c => c.overallSentiment === 'neutral').length;
  const negative = conversations.filter(c => c.overallSentiment === 'negative').length;

  // Resolution and escalation
  const resolved = conversations.filter(c => c.resolutionStatus === 'resolved').length;
  const escalated = conversations.filter(c => c.escalated).length;

  // Friction points
  const allFriction = conversations.flatMap(c => c.frictionPoints);
  const frictionByType: Record<string, number> = {};
  allFriction.forEach(f => {
    frictionByType[f.barrierType] = (frictionByType[f.barrierType] || 0) + 1;
  });

  // Risk conversations
  const highRisk = conversations.filter(c => c.riskLevel === 'high' || c.riskLevel === 'critical').length;
  const avgChurnRisk = Math.round(conversations.reduce((sum, c) => sum + c.churnRisk, 0) / totalConv);
  const abandonmentSignals = conversations.filter(c => c.abandonmentSignals.length > 0).length;

  // Top topics
  const topicCounts: Record<string, { count: number, totalSentiment: number }> = {};
  conversations.forEach(c => {
    c.topicsDetected.forEach(topicId => {
      if (!topicCounts[topicId]) {
        topicCounts[topicId] = { count: 0, totalSentiment: 0 };
      }
      topicCounts[topicId].count++;
      topicCounts[topicId].totalSentiment += c.sentimentScore;
    });
  });

  const topTopicsArray = Object.entries(topicCounts)
    .map(([topicId, data]) => {
      const topic = pharmaTopics.find(t => t.id === topicId);
      return {
        topicId,
        topicName: topic?.name || topicId,
        count: data.count,
        sentiment: data.totalSentiment / data.count,
      };
    })
    .sort((a, b) => b.count - a.count)
    .slice(0, 5);

  // Top call drivers
  const driverCounts: Record<string, number> = {};
  conversations.forEach(c => {
    driverCounts[c.callDriver] = (driverCounts[c.callDriver] || 0) + 1;
  });
  const topDrivers = Object.entries(driverCounts)
    .map(([driver, count]) => ({ driver, count }))
    .sort((a, b) => b.count - a.count)
    .slice(0, 5);

  return {
    totalConversations: totalConv,
    conversationChange: 12, // hardcoded for demo
    conversationsByType: byType as any,
    callVolumeByDay: [
      { date: '2024-10-24', count: 1 },
      { date: '2024-10-25', count: 0 },
      { date: '2024-10-26', count: 1 },
      { date: '2024-10-27', count: 0 },
      { date: '2024-10-28', count: 1 },
      { date: '2024-10-29', count: 0 },
      { date: '2024-10-30', count: 3 },
    ],
    avgSentimentScore: avgSentiment,
    sentimentDistribution: {
      positive: Math.round((positive / totalConv) * 100),
      neutral: Math.round((neutral / totalConv) * 100),
      negative: Math.round((negative / totalConv) * 100),
    },
    sentimentTrend: 'up',
    avgResolutionRate: Math.round((resolved / totalConv) * 100),
    avgHandleTime: avgHandleTime,
    firstCallResolutionRate: Math.round((resolved / totalConv) * 100),
    escalationRate: Math.round((escalated / totalConv) * 100),
    avgCsatScore: parseFloat(avgCsat.toFixed(1)),
    avgNpsScore: parseFloat(avgNps.toFixed(1)),
    avgQualityScore: Math.round(avgQuality),
    avgComplianceScore: Math.round(avgCompliance),
    totalFrictionPoints: allFriction.length,
    frictionByType: frictionByType as any,
    avgFrictionScore: Math.round(conversations.reduce((sum, c) => sum + c.frictionScore, 0) / totalConv),
    highRiskConversations: highRisk,
    abandonmentSignalsDetected: abandonmentSignals,
    avgChurnRisk: avgChurnRisk,
    topTopics: topTopicsArray,
    topCallDrivers: topDrivers,
  };
};

// Aggregate metrics calculated from real data
export const conversationMetrics: ConversationMetrics = calculateMetrics();

// Root cause analysis
export const rootCauseAnalysis: RootCauseAnalysis[] = [
  {
    barrierType: 'insurance',
    barrierName: 'Insurance & Coverage Issues',
    occurrences: 124,
    percentOfTotal: 36,
    avgSeverity: 68,
    resolutionRate: 78,
    avgTimeToResolve: 420,
    trendDirection: 'up',
    affectedPatients: 98,
    correlatedTopics: ['topic-copay', 'topic-prior-auth', 'topic-abandonment'],
    commonPhrases: [
      'insurance denied',
      'not covered',
      'copay too high',
      'waiting for approval',
      'pre-authorization required',
    ],
    exampleSnippets: [
      'My insurance company said this isn\'t covered under my plan',
      'The copay is $300 - I can\'t afford that',
      'I\'ve been waiting 3 weeks for prior authorization',
    ],
    actionRecommendations: [
      'Streamline prior authorization process',
      'Proactively offer copay assistance enrollment',
      'Improve insurance verification at intake',
    ],
  },
  {
    barrierType: 'affordability',
    barrierName: 'Cost & Affordability Concerns',
    occurrences: 89,
    percentOfTotal: 26,
    avgSeverity: 75,
    resolutionRate: 82,
    avgTimeToResolve: 280,
    trendDirection: 'up',
    affectedPatients: 76,
    correlatedTopics: ['topic-copay', 'topic-abandonment'],
    commonPhrases: [
      'too expensive',
      'can\'t afford',
      'cost too much',
      'financial burden',
      'need help paying',
    ],
    exampleSnippets: [
      'This medication is just too expensive for me',
      'I don\'t know if I can keep affording this',
      'Is there any way to reduce the cost?',
    ],
    actionRecommendations: [
      'Earlier copay program awareness',
      'Provide cost transparency upfront',
      'Offer payment plans or alternatives',
    ],
  },
  {
    barrierType: 'access',
    barrierName: 'Access & Availability Barriers',
    occurrences: 67,
    percentOfTotal: 20,
    avgSeverity: 58,
    resolutionRate: 91,
    avgTimeToResolve: 180,
    trendDirection: 'stable',
    affectedPatients: 54,
    correlatedTopics: ['topic-refill', 'topic-adherence'],
    commonPhrases: [
      'pharmacy doesn\'t have it',
      'shipping delay',
      'out of stock',
      'haven\'t received',
      'where can I get',
    ],
    exampleSnippets: [
      'My pharmacy said they don\'t carry this medication',
      'I was supposed to receive my shipment 2 days ago',
      'How long will it take to get my prescription?',
    ],
    actionRecommendations: [
      'Improve specialty pharmacy coordination',
      'Proactive shipment tracking and communication',
      'Build network of specialty pharmacies',
    ],
  },
  {
    barrierType: 'clinical',
    barrierName: 'Clinical Concerns & Side Effects',
    occurrences: 45,
    percentOfTotal: 13,
    avgSeverity: 82,
    resolutionRate: 67,
    avgTimeToResolve: 520,
    trendDirection: 'up',
    affectedPatients: 42,
    correlatedTopics: ['topic-side-effects', 'topic-abandonment', 'topic-escalation'],
    commonPhrases: [
      'side effects',
      'not working',
      'feeling worse',
      'adverse reaction',
      'need to stop',
    ],
    exampleSnippets: [
      'I\'ve been having terrible headaches since starting this',
      'The injection site is really painful and swollen',
      'I don\'t think this medication is working for me',
    ],
    actionRecommendations: [
      'Earlier side effect education and expectation setting',
      'Faster nurse callback for clinical concerns',
      'Proactive follow-up after medication start',
    ],
  },
  {
    barrierType: 'process',
    barrierName: 'Process Confusion & Complexity',
    occurrences: 12,
    percentOfTotal: 4,
    avgSeverity: 42,
    resolutionRate: 94,
    avgTimeToResolve: 145,
    trendDirection: 'down',
    affectedPatients: 11,
    correlatedTopics: ['topic-administration', 'topic-enrollment'],
    commonPhrases: [
      'how do I',
      'confused about',
      'don\'t understand',
      'what do I do',
      'unclear instructions',
    ],
    exampleSnippets: [
      'I\'m not sure how to use this injection pen',
      'The instructions are confusing',
      'What are the steps to enroll?',
    ],
    actionRecommendations: [
      'Simplify patient-facing materials',
      'Provide video tutorials',
      'Enhance onboarding education',
    ],
  },
];

// Sample conversation snippets
export const conversationSnippets: ConversationSnippet[] = [
  {
    id: 'snippet-001',
    conversationId: 'call-001',
    title: 'Successful Copay Enrollment',
    description: 'Perfect example of smooth enrollment with clear value communication',
    startMessageIndex: 2,
    endMessageIndex: 9,
    messages: analyzedConversations[0].transcript.slice(2, 10),
    tags: ['copay', 'enrollment', 'best-practice'],
    topicsRelated: ['topic-copay', 'topic-enrollment'],
    useCase: 'training',
    rating: 5,
    createdBy: 'System',
    createdAt: '2025-01-28',
    shared: true,
  },
  {
    id: 'snippet-002',
    conversationId: 'call-002',
    title: 'Therapy Abandonment Signal',
    description: 'Patient questioning medication value - critical moment requiring escalation',
    startMessageIndex: 3,
    endMessageIndex: 6,
    messages: analyzedConversations[1].transcript.slice(3, 7),
    tags: ['abandonment', 'escalation', 'high-risk'],
    topicsRelated: ['topic-abandonment', 'topic-side-effects'],
    useCase: 'escalation',
    rating: 4,
    createdBy: 'System',
    createdAt: '2025-01-27',
    shared: true,
  },
];
